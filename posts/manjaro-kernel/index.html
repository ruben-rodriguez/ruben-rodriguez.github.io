<!doctype html><html lang=en><head><title>Linux Kernel - Manjaro breaking dependencies ::
Ruben Rodriguez — Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Context # One day you find yourself running your Manjaro installation as usual, and you think of installing a new fancy package which will provide you with some new fancy tool or software. Usually, before installing any package you perform an upgrade of all system packages by running pacman -Syu command. And then you find:
λ sudo pacman -Syu :: Synchronizing package databases... core is up to date extra is up to date community is up to date multilib is up to date :: Starting full system upgrade."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://ruben-rodriguez.github.io/posts/manjaro-kernel/><link rel=stylesheet href=https://ruben-rodriguez.github.io/assets/style.css><link rel=stylesheet href=https://ruben-rodriguez.github.io/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://ruben-rodriguez.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://ruben-rodriguez.github.io/img/favicon.png><link href=https://ruben-rodriguez.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://ruben-rodriguez.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://ruben-rodriguez.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://ruben-rodriguez.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://ruben-rodriguez.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://ruben-rodriguez.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux Kernel - Manjaro breaking dependencies"><meta name=twitter:description content="EOL Kernels prevent system upgrade"><meta property="og:title" content="Linux Kernel - Manjaro breaking dependencies"><meta property="og:description" content="EOL Kernels prevent system upgrade"><meta property="og:type" content="article"><meta property="og:url" content="https://ruben-rodriguez.github.io/posts/manjaro-kernel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-15T00:00:00+08:00"><meta property="article:modified_time" content="2022-04-15T00:00:00+08:00"><meta property="og:site_name" content="Ruben Rodriguez"><meta name=google-site-verification content="6jS-Osezzv4luRDVRg4jM8iulRYMMuOGdU-httJV8Ig"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Ruben Rodriguez</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/posts>Posts</a></li><li><a href=/tags>Tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/posts>Posts</a></li><li><a href=/tags>Tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Linux Kernel - Manjaro breaking dependencies</h1><div class=post-meta><span class=post-date>2022-04-15</span>
<span class=post-author>— Written by Ruben</span></div><span class=post-tags><a href=https://ruben-rodriguez.github.io/tags/linux/>#Linux</a>&nbsp;
<a href=https://ruben-rodriguez.github.io/tags/kernel/>#Kernel</a>&nbsp;
<a href=https://ruben-rodriguez.github.io/tags/manjaro/>#Manjaro</a>&nbsp;</span><div class=post-content><h2 id=context>Context
<a href=#context class=h-anchor aria-hidden=true>#</a></h2><p>One day you find yourself running your Manjaro installation as usual, and you think of installing a new fancy package which will provide you with some new fancy tool or software. Usually, before installing any package you perform an upgrade of all system packages by running <code>pacman -Syu</code> command. And then you find:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> λ  sudo pacman -Syu
</span></span><span style=display:flex><span>:: Synchronizing package databases...
</span></span><span style=display:flex><span> core is up to date
</span></span><span style=display:flex><span> extra is up to date
</span></span><span style=display:flex><span> community is up to date
</span></span><span style=display:flex><span> multilib is up to date
</span></span><span style=display:flex><span>:: Starting full system upgrade...
</span></span><span style=display:flex><span>resolving dependencies...
</span></span><span style=display:flex><span>looking <span style=color:#66d9ef>for</span> conflicting packages...
</span></span><span style=display:flex><span>error: failed to prepare transaction <span style=color:#f92672>(</span>could not satisfy dependencies<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>:: installing nvidia-utils <span style=color:#f92672>(</span>510.73.05-1<span style=color:#f92672>)</span> breaks dependency <span style=color:#e6db74>&#39;nvidia-utils=510.68.02&#39;</span> required by linux516-nvidia
</span></span></code></pre></div><p>Congratulations! You are probably running a no longer supported Linux Kernel!</p><p>Folks over <a href=https://endoflife.date/linux>endoflife.date</a> have a really nice site to check on different Kernels and packages releases and EOLs (End Of Life) so you can check and be ready to find your Kernel EOLed.</p><p>Of course, you can avoid all this nightmare by running an LTS Kernel (like Linux 5.10 at the time of writing this) but, if you are like me, you will be likely running the latest stable release; yeah, I&rsquo;m not that hardcore to run unstable releases (I use this machine to do some work on it) and, for such case, I&rsquo;d be running plain Arch Linux, which is rolling release and my favourite distribution!</p><h2 id=troubleshooting>Troubleshooting
<a href=#troubleshooting class=h-anchor aria-hidden=true>#</a></h2><p>Let&rsquo;s first check what Kernels I do have currently installed in my system with the help of <code>mhwd-kernel</code> utility (you can find more information about it in <a href=https://wiki.manjaro.org/index.php/Manjaro_Kernels>Manjaro Wiki</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -li
</span></span><span style=display:flex><span>Currently running: 5.16.20-2-MANJARO <span style=color:#f92672>(</span>linux516<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>The following kernels are installed in your system:
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux516
</span></span></code></pre></div><p>Checking the <a href=https://endoflife.date/linux>endoflife.date</a> and also having a look at <a href=https://www.kernel.org/>Kernel.org</a>, I can see the current stable release is 5.17.9, hence 5.16 is not supported anymore. We can also see the available Kernels that can be installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -l
</span></span><span style=display:flex><span>available kernels:
</span></span><span style=display:flex><span>   * linux414
</span></span><span style=display:flex><span>   * linux419
</span></span><span style=display:flex><span>   * linux49
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux515
</span></span><span style=display:flex><span>   * linux517
</span></span><span style=display:flex><span>   * linux518
</span></span><span style=display:flex><span>   * linux54
</span></span><span style=display:flex><span>   * linux515-rt
</span></span><span style=display:flex><span>   * linux517-rt
</span></span></code></pre></div><p>Using the same tool (<code>mhwd-kernel</code>), I will now install the supported stable release according to <a href=https://www.kernel.org/>Kernel.org</a> site:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -i linux517
</span></span><span style=display:flex><span>:: Synchronizing package databases...
</span></span><span style=display:flex><span> core                                                                                              166,9 KiB   <span style=color:#ae81ff>835</span> KiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span> extra                                                                                            1896,1 KiB  10,9 MiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span> community                                                                                           7,0 MiB  38,2 MiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span> multilib                                                                                          177,5 KiB  4,68 MiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span>resolving dependencies...
</span></span><span style=display:flex><span>looking <span style=color:#66d9ef>for</span> conflicting packages...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Packages <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> linux517-5.17.9-1  linux517-nvidia-510.73.05-1  linux517-virtualbox-host-modules-6.1.34-9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Total Download Size:    35,83 MiB
</span></span><span style=display:flex><span>Total Installed Size:  159,14 MiB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:: Proceed with installation? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y
</span></span></code></pre></div><p>We can see that installing the Kernel also installs the required <code>linux517-*</code> packages, including the one that is now outdated in the EOLed Kernel (<code>linux516-nvidia</code>) and is preventing the system upgrade.</p><p>Once installation finishes, you can reboot the machine; listing the installed Kernels we can now see:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -li
</span></span><span style=display:flex><span>Currently running: 5.17.9-1-MANJARO <span style=color:#f92672>(</span>linux517<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>The following kernels are installed in your system:
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux516
</span></span><span style=display:flex><span>   * linux517
</span></span></code></pre></div><p>I&rsquo;ll now remove the EOLed Kernel by executing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -r linux516
</span></span><span style=display:flex><span>checking dependencies...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Packages <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> linux516-5.15.41-1  linux516-nvidia-510.73.05-1  linux516-virtualbox-host-modules-6.1.34-9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Total Removed Size:  140,58 MiB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:: Do you want to remove these packages? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y
</span></span><span style=display:flex><span>:: Running pre-transaction hooks...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1/1<span style=color:#f92672>)</span> Removing linux initcpios...
</span></span><span style=display:flex><span>:: Processing package changes...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1/3<span style=color:#f92672>)</span> removing linux516-virtualbox-host-modules                                                                                <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2/3<span style=color:#f92672>)</span> removing linux516-nvidia                                                                                                 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3/3<span style=color:#f92672>)</span> removing linux516                                                                                                        <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span>:: Running post-transaction hooks...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1/4<span style=color:#f92672>)</span> Arming ConditionNeedsUpdate...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2/4<span style=color:#f92672>)</span> Updating module dependencies...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3/4<span style=color:#f92672>)</span> Updating Kernel initcpios <span style=color:#66d9ef>for</span> Nvidia-DRM...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>4/4<span style=color:#f92672>)</span> Updating Grub-Bootmenu
</span></span><span style=display:flex><span>Generating grub configuration file ...
</span></span><span style=display:flex><span>Found linux image: /boot/vmlinuz-5.17-x86_64
</span></span><span style=display:flex><span>Found initrd image: /boot/intel-ucode.img /boot/initramfs-5.17-x86_64.img
</span></span><span style=display:flex><span>Found initrd fallback image: /boot/initramfs-5.17-x86_64-fallback.img
</span></span><span style=display:flex><span>Found linux image: /boot/vmlinuz-5.10-x86_64
</span></span><span style=display:flex><span>Found initrd image: /boot/intel-ucode.img /boot/initramfs-5.10-x86_64.img
</span></span><span style=display:flex><span>Found initrd fallback image: /boot/initramfs-5.10-x86_64-fallback.img
</span></span><span style=display:flex><span>Found memtest86+ image: /boot/memtest86+/memtest.bin
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>Aaaaand, it&rsquo;s gone:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -li
</span></span><span style=display:flex><span>Currently running: 5.17.9-1-MANJARO <span style=color:#f92672>(</span>linux517<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>The following kernels are installed in your system:
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux517
</span></span></code></pre></div><p>You should be able now to proceed with the system packages upgrade as usual leveraging <code>pacman -Syu</code> command.</p><h2 id=recommendations>Recommendations
<a href=#recommendations class=h-anchor aria-hidden=true>#</a></h2><p>It&rsquo;s considered a good practice to have a LTS Kernel installed, just in case things break; I have Linux 5.10 release as LTS fallback installed.</p><p>Imagine you screw things when you first see the message about the dependency breaking and you opt to remove the <code>linux516-nvidia</code> package. Cool, system upgrade will work, but the next time you boot your machine you will find a nice black screen due to NVIDIA drivers now gone from your installation. Ok, you better search for your Manjaro installation media so you can <code>chroot</code> and fix things&mldr; or not!</p><p>As you followed the general recommendation of having a LTS Kernel installed, you will be able to boot it from the <code>Advanced options</code> in your boot loader; once booted, you can then install whatever Kernel you wish to run (a supported one), and then boot into it and work as usual.</p><h2 id=manjaro-kernel-management-summary>Manjaro Kernel Management Summary
<a href=#manjaro-kernel-management-summary class=h-anchor aria-hidden=true>#</a></h2><p>To list installed kernels in the machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -li
</span></span></code></pre></div><p>To list available Kernels for installation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -l
</span></span></code></pre></div><p>To remove a Kernel</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -r kernel-name
</span></span></code></pre></div><p>To add a Kernel, aka linux 418</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -i kernel-name
</span></span></code></pre></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://ruben-rodriguez.github.io/posts/kube-prom-stack-blackbox/><span class=button__icon>←</span>
<span class=button__text>Endpoints Monitoring - BlackBox Exporter</span></a></span>
<span class="button next"><a href=https://ruben-rodriguez.github.io/posts/dynamodb-item-counts/><span class=button__text>DynamoDB item count</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Ruben Rodriguez</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://ruben-rodriguez.github.io/assets/main.js></script>
<script src=https://ruben-rodriguez.github.io/assets/prism.js></script></div></body></html>