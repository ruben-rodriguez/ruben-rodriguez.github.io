<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Ruben"><meta name=description content="EOL Kernels prevent system upgrade"><meta name=keywords content="homepage,blog,Linux,Kernel,Manjaro"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://ruben-rodriguez.github.io/posts/manjaro-kernel/><title>Linux Kernel - Manjaro breaking dependencies :: Ruben Rodriguez — Some personal notes and random thoughts</title><link rel=stylesheet href=/main.min.7289daf2e88ea2c7b253a51cc5794c7cc17e7aeb7295a19d978db764a5862f25.css integrity="sha256-cona8uiOoseyU6UcxXlMfMF+eutylaGdl423ZKWGLyU=" crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Linux Kernel - Manjaro breaking dependencies"><meta itemprop=description content="EOL Kernels prevent system upgrade"><meta itemprop=datePublished content="2022-04-15T00:00:00+08:00"><meta itemprop=dateModified content="2022-04-15T00:00:00+08:00"><meta itemprop=wordCount content="841"><meta itemprop=image content="https://ruben-rodriguez.github.io/"><meta itemprop=keywords content="Linux,Kernel,Manjaro"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ruben-rodriguez.github.io/"><meta name=twitter:title content="Linux Kernel - Manjaro breaking dependencies"><meta name=twitter:description content="EOL Kernels prevent system upgrade"><meta property="article:published_time" content="2022-04-15 00:00:00 +0800 +0800"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>Ruben Rodriguez</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about>About</a></li><li><a href=/posts>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p></p></div><article><h1 class=post-title><a href=https://ruben-rodriguez.github.io/posts/manjaro-kernel/>Linux Kernel - Manjaro breaking dependencies</a></h1><div class=post-excerpt>EOL Kernels prevent system upgrade</div><div class=post-content><h2 id=context>Context</h2><p>One day you find yourself running your Manjaro installation as usual, and you think of installing a new fancy package which will provide you with some new fancy tool or software. Usually, before installing any package you perform an upgrade of all system packages by running <code>pacman -Syu</code> command. And then you find:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span> λ  sudo pacman -Syu
</span></span><span style=display:flex><span>:: Synchronizing package databases...
</span></span><span style=display:flex><span> core is up to date
</span></span><span style=display:flex><span> extra is up to date
</span></span><span style=display:flex><span> community is up to date
</span></span><span style=display:flex><span> multilib is up to date
</span></span><span style=display:flex><span>:: Starting full system upgrade...
</span></span><span style=display:flex><span>resolving dependencies...
</span></span><span style=display:flex><span>looking <span style=color:#66d9ef>for</span> conflicting packages...
</span></span><span style=display:flex><span>error: failed to prepare transaction <span style=color:#f92672>(</span>could not satisfy dependencies<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>:: installing nvidia-utils <span style=color:#f92672>(</span>510.73.05-1<span style=color:#f92672>)</span> breaks dependency <span style=color:#e6db74>&#39;nvidia-utils=510.68.02&#39;</span> required by linux516-nvidia
</span></span></code></pre></div><p>Congratulations! You are probably running a no longer supported Linux Kernel!</p><p>Folks over <a href=https://endoflife.date/linux>endoflife.date</a> have a really nice site to check on different Kernels and packages releases and EOLs (End Of Life) so you can check and be ready to find your Kernel EOLed.</p><p>Of course, you can avoid all this nightmare by running an LTS Kernel (like Linux 5.10 at the time of writing this) but, if you are like me, you will be likely running the latest stable release; yeah, I&rsquo;m not that hardcore to run unstable releases (I use this machine to do some work on it) and, for such case, I&rsquo;d be running plain Arch Linux, which is rolling release and my favourite distribution!</p><h2 id=troubleshooting>Troubleshooting</h2><p>Let&rsquo;s first check what Kernels I do have currently installed in my system with the help of <code>mhwd-kernel</code> utility (you can find more information about it in <a href=https://wiki.manjaro.org/index.php/Manjaro_Kernels>Manjaro Wiki</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -li
</span></span><span style=display:flex><span>Currently running: 5.16.20-2-MANJARO <span style=color:#f92672>(</span>linux516<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>The following kernels are installed in your system:
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux516
</span></span></code></pre></div><p>Checking the <a href=https://endoflife.date/linux>endoflife.date</a> and also having a look at <a href=https://www.kernel.org/>Kernel.org</a>, I can see the current stable release is 5.17.9, hence 5.16 is not supported anymore. We can also see the available Kernels that can be installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -l
</span></span><span style=display:flex><span>available kernels:
</span></span><span style=display:flex><span>   * linux414
</span></span><span style=display:flex><span>   * linux419
</span></span><span style=display:flex><span>   * linux49
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux515
</span></span><span style=display:flex><span>   * linux517
</span></span><span style=display:flex><span>   * linux518
</span></span><span style=display:flex><span>   * linux54
</span></span><span style=display:flex><span>   * linux515-rt
</span></span><span style=display:flex><span>   * linux517-rt
</span></span></code></pre></div><p>Using the same tool (<code>mhwd-kernel</code>), I will now install the supported stable release according to <a href=https://www.kernel.org/>Kernel.org</a> site:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -i linux517
</span></span><span style=display:flex><span>:: Synchronizing package databases...
</span></span><span style=display:flex><span> core                                                                                              166,9 KiB   <span style=color:#ae81ff>835</span> KiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span> extra                                                                                            1896,1 KiB  10,9 MiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span> community                                                                                           7,0 MiB  38,2 MiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span> multilib                                                                                          177,5 KiB  4,68 MiB/s 00:00 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span>resolving dependencies...
</span></span><span style=display:flex><span>looking <span style=color:#66d9ef>for</span> conflicting packages...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Packages <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> linux517-5.17.9-1  linux517-nvidia-510.73.05-1  linux517-virtualbox-host-modules-6.1.34-9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Total Download Size:    35,83 MiB
</span></span><span style=display:flex><span>Total Installed Size:  159,14 MiB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:: Proceed with installation? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y
</span></span></code></pre></div><p>We can see that installing the Kernel also installs the required <code>linux517-*</code> packages, including the one that is now outdated in the EOLed Kernel (<code>linux516-nvidia</code>) and is preventing the system upgrade.</p><p>Once installation finishes, you can reboot the machine; listing the installed Kernels we can now see:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -li
</span></span><span style=display:flex><span>Currently running: 5.17.9-1-MANJARO <span style=color:#f92672>(</span>linux517<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>The following kernels are installed in your system:
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux516
</span></span><span style=display:flex><span>   * linux517
</span></span></code></pre></div><p>I&rsquo;ll now remove the EOLed Kernel by executing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -r linux516
</span></span><span style=display:flex><span>checking dependencies...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Packages <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> linux516-5.15.41-1  linux516-nvidia-510.73.05-1  linux516-virtualbox-host-modules-6.1.34-9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Total Removed Size:  140,58 MiB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:: Do you want to remove these packages? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y
</span></span><span style=display:flex><span>:: Running pre-transaction hooks...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1/1<span style=color:#f92672>)</span> Removing linux initcpios...
</span></span><span style=display:flex><span>:: Processing package changes...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1/3<span style=color:#f92672>)</span> removing linux516-virtualbox-host-modules                                                                                <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2/3<span style=color:#f92672>)</span> removing linux516-nvidia                                                                                                 <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3/3<span style=color:#f92672>)</span> removing linux516                                                                                                        <span style=color:#f92672>[</span><span style=color:#75715e>#############################################################################] 100%</span>
</span></span><span style=display:flex><span>:: Running post-transaction hooks...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1/4<span style=color:#f92672>)</span> Arming ConditionNeedsUpdate...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2/4<span style=color:#f92672>)</span> Updating module dependencies...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3/4<span style=color:#f92672>)</span> Updating Kernel initcpios <span style=color:#66d9ef>for</span> Nvidia-DRM...
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>4/4<span style=color:#f92672>)</span> Updating Grub-Bootmenu
</span></span><span style=display:flex><span>Generating grub configuration file ...
</span></span><span style=display:flex><span>Found linux image: /boot/vmlinuz-5.17-x86_64
</span></span><span style=display:flex><span>Found initrd image: /boot/intel-ucode.img /boot/initramfs-5.17-x86_64.img
</span></span><span style=display:flex><span>Found initrd fallback image: /boot/initramfs-5.17-x86_64-fallback.img
</span></span><span style=display:flex><span>Found linux image: /boot/vmlinuz-5.10-x86_64
</span></span><span style=display:flex><span>Found initrd image: /boot/intel-ucode.img /boot/initramfs-5.10-x86_64.img
</span></span><span style=display:flex><span>Found initrd fallback image: /boot/initramfs-5.10-x86_64-fallback.img
</span></span><span style=display:flex><span>Found memtest86+ image: /boot/memtest86+/memtest.bin
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>Aaaaand, it&rsquo;s gone:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>λ  sudo mhwd-kernel -li
</span></span><span style=display:flex><span>Currently running: 5.17.9-1-MANJARO <span style=color:#f92672>(</span>linux517<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>The following kernels are installed in your system:
</span></span><span style=display:flex><span>   * linux510
</span></span><span style=display:flex><span>   * linux517
</span></span></code></pre></div><p>You should be able now to proceed with the system packages upgrade as usual leveraging <code>pacman -Syu</code> command.</p><h2 id=recommendations>Recommendations</h2><p>It&rsquo;s considered a good practice to have a LTS Kernel installed, just in case things break; I have Linux 5.10 release as LTS fallback installed.</p><p>Imagine you screw things when you first see the message about the dependency breaking and you opt to remove the <code>linux516-nvidia</code> package. Cool, system upgrade will work, but the next time you boot your machine you will find a nice black screen due to NVIDIA drivers now gone from your installation. Ok, you better search for your Manjaro installation media so you can <code>chroot</code> and fix things&mldr; or not!</p><p>As you followed the general recommendation of having a LTS Kernel installed, you will be able to boot it from the <code>Advanced options</code> in your boot loader; once booted, you can then install whatever Kernel you wish to run (a supported one), and then boot into it and work as usual.</p><h2 id=manjaro-kernel-management-summary>Manjaro Kernel Management Summary</h2><p>To list installed kernels in the machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -li
</span></span></code></pre></div><p>To list available Kernels for installation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -l
</span></span></code></pre></div><p>To remove a Kernel</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -r kernel-name
</span></span></code></pre></div><p>To add a Kernel, aka linux 418</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mhwd-kernel -i kernel-name
</span></span></code></pre></div></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://ruben-rodriguez.github.io/tags/linux/>Linux</a></span>
<span class=tag><a href=https://ruben-rodriguez.github.io/tags/kernel/>Kernel</a></span>
<span class=tag><a href=https://ruben-rodriguez.github.io/tags/manjaro/>Manjaro</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
841 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2022-04-14 16:00</p></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://ruben-rodriguez.github.io/posts/kube-prom-stack-blackbox/><span class=button__icon>←</span>
<span class=button__text>Endpoints Monitoring - BlackBox Exporter</span>
</a></span><span class="button next"><a href=https://ruben-rodriguez.github.io/posts/dynamodb-item-counts/><span class=button__text>DynamoDB item count</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.08b680078a3cf9c69e3dd217a5aa52cfddd4a1d850f8cdff127fdd7421a71f8b2b474be69386f67819edace92273916e7230c9054f38107db9dc6730b3530ab5.js integrity="sha512-CLaAB4o8+caePdIXpapSz93UodhQ+M3/En/ddCGnH4srR0vmk4b2eBntrOkic5FucjDJBU84EH253Gcws1MKtQ=="></script></body></html>